<h1>ViViz</h1>
<p>Software for browsing, sorting, and subsetting pre-generated images in a web browser.  It is an out-growth of the <a href="http://virbo.org/">ViRBO</a> project.</p>
<p><a href="http://viviz.org/gallery/">Demo page</a></p>
<h1>Use</h1>
<p>If remote images are available from an HTTP address and the filenames follow a simple pattern, the images may be viewed by appending parameters to the URL <code>http://viviz.org/#</code>.  For alternative usage, including for viewing local images, see <a href="Installation">Installation</a>.</p>
<p><strong>Example</strong></p>
<p>The directory http://sohowww.nascom.nasa.gov/data/synoptic/sunspots_earth/ contains image files of the form <code>sunspots_512_$Y$m$d.jpg</code> (see <a href="URI Templates">URI_Templates</a> for information on expressing filenames and URLs as a template).</p>
<p>To view this images, use the URL
http://viviz.org/#dir=http://sohowww.nascom.nasa.gov/data/synoptic/sunspots_earth/&amp;strftime=sunspots_512_$Y$m$d.jpg&amp;start=2006-01-20&amp;stop=P0D</p>
<p>The <a href="http://sohowww.nascom.nasa.gov/data/synoptic/sunspots_earth/">directory</a> contains images of two sizes.  To specify different full and thumbnail images, use</p>
<p>http://viviz.org/#dir=http://sohowww.nascom.nasa.gov/data/synoptic/sunspots_earth/&amp;fullstrftime=sunspots_1024_$Y$m$d.jpg&amp;thumbstrftime=sunspots_512_$Y$m$d.jpg&amp;start=2006-01-20&amp;stop=P0D</p>
<h2>Performance Hints</h2>
<p>If you have control over the image creation process,
<em> Use thumbnail images.
</em> Use interlaced PNG encoding for large full-sized images.
* Use [https://pngquant.org/ PNGQuant] for reducing PNG image sizes significantly without visible degradation.</p>
<h2>Installation</h2>
<h3>Basic</h3>
<ul>
<li>Open http://viviz.org/index.htm</li>
<li>Select <code>File &gt; Save As &gt; index.htm</code>
or</li>
<li><code>curl -O &lt;nowiki&gt;http://viviz.org//index.htm</code></li>
<li>Open the saved <code>index.htm</code> file in a web browser</li>
</ul>
<p>To configure,
<em> Modify one of the gallery <a href="#Configuration">configuration</a> examples at the top of <code>index.htm</code> with a text editor. 
or
</em> Append arguments to <code>index.htm</code>, e.g., 
:<code>index.htm#dir=file:///path/to/images/&amp;strftime=...&amp;start=...&amp;stop=...</code>
:<code>index.htm#dir=dir=http://sohowww.nascom.nasa.gov/data/synoptic/sunspots_earth/&amp;strftime=sunspots_512_$Y$m$d.jpg&amp;start=2006-01-20&amp;stop=P0D</code></p>
<h3>Web Server</h3>
<p>In this mode, directories for the location of the directory may be relative and the parameter <code>list</code> may be a relative path.  For absolute URLs, a [[#Full Application]] installation is required.</p>
<p>curl http://viviz.org/index.htm &gt; /server/root/dir/index.htm
or
 git pull http://github.com/rweigel/viviz</p>
<h3>Full Application</h3>
<p>The full application includes a web server and a proxy server that retrieves remote file lists and remote catalogs and requires installation of <a href="http://node.js/">Node</a>.</p>
<p><code>git clone https://github.com/rweigel/viviz
 cd viviz
 npm install
 node viviz.js --port 8002</code></p>
<p>and open http://localhost:8002/ with a web browser.</p>
<h3>Configuration</h3>
<p>The variable <code>VIVIZ</code> in <code>index.htm</code> contains all of the application and gallery configuation options.</p>
<p>To see the gallery configuation for the gallery in view, select the Gallery configuration link.  See also <code>index.htm</code> for many examples of gallery configurations.</p>
<p>Any configuration option that appears in <code>VIVIZ["config"]</code> is over-ridden by a same-named option that appears in a gallery configuation or a parameter in the query string.</p>
<p>The main configuration parameters for a gallery are
<em> <code>fulldir</code> or <code>dir</code>: A URL to the location of full-sized image files (default is same directory of index.html)
</em> <code>thumbdir</code>: A URL to the location of reduced-size versions of the full-sized images (default is <code>fulldir</code>).
<em> <code>fullfiles</code> or <code>files</code>: A list of image filenames that are appended to <code>fulldir</code>.
</em> <code>thumbfiles</code>: A list of image filenames that are appended to <code>thumbdir</code> (default is <code>fullfiles</code>).  </p>
<p>The format of the lists is either a Javascript array of the form
<code>[["demo-2001.png"],["demo-2002.png"],["demo-2003.png"],["demo-2004.png"]]</code>
or a new-line separated list
<code>"demo-2001.png\ndemo-2002.png\ndemo-2003.png\ndemo-2004.png"</code></p>
<p>When the list of files is long and the filenames have a pattern, the list of image URLs can be represented by <code>sprintf</code> or <code>strftime</code> along with <code>start</code> and <code>stop</code> indices or dates.
<em> <code>sprintf</code> is a [http://linux.die.net/man/3/sprintf formatted string expression]]
</em> <code>strftime</code> is a [http://linux.die.net/man/3/strftime formatted time string expression]
<em> <code>start</code>: Either an integer or a date
</em> <code>stop</code>: Either an integer or a date</p>
<p>When the list of full- or reduced-size image files cannot be desribed using the above parameters, the lists can be specified using <code>list</code> or <code>script</code>, where
<em> <code>list</code> is a <a href="#File List">file</a> containing a list of image file names and their attributes. (Only available for web server and full install; for web server install, paths must be relative.)
</em> <code>script</code> is a <a href="#Script">script</a> that generates a list of files.</p>
<p>If any of the above parameters (excluding <code>start</code> and <code>stop</code>) applies only to either the full- or reduced-sized images, the parameters should be prefixed by <code>full</code> or <code>thumb</code>, respectively.</p>
<h3>File List</h3>
<p>Each image can have zero or more [[#Attributes|attributes]] that can be used to view a subset of the images.  The format is</p>
<p><code>[
  ["file1.png", "attribute1", "attribute2", ..., "attributeM"],
  ...
  ["fileN.png", "attribute1", "attribute2", ..., "attributeM"]
 ]</code>
where attributes that are numbers do not need to be quoted, or
<code>file1.png, attribute1, attribute2, ..., attributeM
  fileN.png, attribute1, attribute2, ..., attributeM</code>
where all attributes are assumed to be strings unless they can be converted to floating point numbers.</p>
<h3>Script</h3>
<p>Any Javascript code that can run in a browser is allowed and the functions <a href="https://github.com/alexei/sprintf.js">sprintf</a> and <a href="http://hacks.bluesmoon.info/strftime/strftime strftime">strftime</a> are available.</p>
<p>The following three examples create the same list of four files.</p>
<p><code>javascript
    function () {
        files = []
        for (i = 0; i &lt; 4; i++) {
            files[i] = ['demo-200' + (i+1) + '.png']
        }
        return files
    }</code></p>
<p><code>javascript
    function () {
        files = []
        for (i = 0; i &lt; 4; i++) {
            files[i] = ['demo-' + sprintf('%02d',i+1) + '.png']
        }
        return files
    }</code></p>
<p><code>javascript
    function () {
        files = []
        for (i = 0; i &lt; 4; i++) {
            files[i] = ['demo-' + strftime('%Y',2000+i+1) + '.png']
        }
        return files
    }</code></p>
<h3>Attributes and Filters</h3>
<ul>
<li>Each image can have zero or more attributes and each attribute can have zero or more filters that allow for showing only a subset of images. </li>
<li>Filters expressions can be either regular expressions (for string attributes) or logical expressions (for numeric attributes).  To refer to the value of the attribute in logical expressions, use the <code>this</code> keyword.</li>
</ul>
<p>When <code>strftime</code> has a year pattern (<code>$Y</code>), a drop-down menu is automatically created that allows viewing all of the images or only one year of images.</p>
<p><code>file1.png, "AB", 4.0
 file2.png, "BC", 5.0
 ...</code></p>
<p><code>javascript
[
    {
        "name": "Attribute 1",
        "filters":
            [
                {"name": "All", "value": ".*"},
                {"name": "Attribute 1 contains the letter C", "value": ".*C"},
            ]
    },
    {
        "name": "Attribute 2",
        "unit": "nT&amp;#183;hr",
        "format": "%.1f",
        "filters":
            [
                {"name": "All", "value": true},
                {"name": "Attribute 2 is greater than 4.0", "value": "this &gt; 4.0"}
            ]
    }
}</code></p>